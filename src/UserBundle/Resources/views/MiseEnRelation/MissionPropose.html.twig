<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="{{ asset('css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ asset('css/mission.css') }}" />
    <link rel="stylesheet" href="{{ asset('css/jquery-ui.min.css') }}" />
    <link rel="stylesheet" href="{{ asset('css/PopUp.css') }}" />
    <link rel="stylesheet" href="{{ asset('css/paginate.css') }}" />
    {% block CSS %}{% endblock %}
    <style>
        .hidden{display: none !important;}
        .ui-widget-header{color:black;}
    </style>
    <style>
        .hidden{display: none !important;}
        .ui-widget-header{color:black;}



        .col-md-2, .col-md-10{
            padding:0;
        }
        .panel{
            margin-bottom: 0px;
            background-color: #66afe9;
        }
        .chat-window{
            bottom:0;


            margin-left:10px;
        }
        .chat-window > div > .panel{
            border-radius: 5px 5px 0 0;
        }
        .icon_minim{
            padding:2px 10px;
        }
        .msg_container_base{
            background: #e5e5e5;

            margin: 0;
            padding: 0 10px 10px;
            max-height:300px;
            overflow-x:hidden;
        }
        .top-bar {
            background: #666;
            color: white;
            padding: 10px;
            position: relative;
            overflow: hidden;
        }
        .msg_receive{

            padding-bottom:20px !important;
            margin-right:0;

        }
        .msg_receive > time{
            float: left;
        }
        .msg_sent{
            padding-bottom:20px !important;
            margin-right:0;
        }
        .messages {
            background: lightgoldenrodyellow;

            padding: 10px;
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            max-width:100%;
        }

        .messages > p {
            font-size: 13px;
            margin: 0 0 0.2rem 0;
        }
        .messages > time {
            font-size: 11px;
            color: grey;
        }
        .msg_container {
            padding: 10px;

            display: flex;
        }
        img {
            display: block;
            width: 100%;
        }
        .avatar {
            position: relative;
        }


        .base_sent {
            justify-content: flex-end;
            align-items: flex-end;

        }


        .msg_sent > time{
            float: right;
        }





        .msg_container_base::-webkit-scrollbar-track
        {
            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
            background-color: #F5F5F5;
        }

        .msg_container_base::-webkit-scrollbar
        {
            width: 12px;
            background-color: #F5F5F5;
        }

        .msg_container_base::-webkit-scrollbar-thumb
        {
            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
            background-color: #555;
        }

        .btn-group.dropup{
            position:fixed;
            left:0px;
            bottom:0;
        }
    </style>
    <title>HUB3E - {% block title %}Home{% endblock %}</title>

</head>
<body onunload="window.parent.document.getElementById('iframe').style.position ='static';window.parent.document.getElementById('iframe').style.height ='calc(100% - 72px)';">

<div id="CompteRendu" class="popup" >
    <div onclick="fermeture();hide(this)" class="close"></div>
    <div class="col-xs-offset-1 col-xs-7" style="background-color: white;padding: 0;border:20px solid white;display: block; margin-left: 20%; ">

        <form id="PopUpCompteRendu" class="formulaire" method="post">


            <div class="div_form" id="Assister" style="display: none">
                <div class="row" style=" margin-bottom: 20px;">

                    <div class="col-xs-12" >
                        <textarea style="height: 200px;resize: none;" class="input" name="CompteRendu" placeholder="Compte rendu" required ></textarea>
                    </div>
                </div>
            </div>

            <div class="div_form" id="Absence" style="display: none" >

                <div class="row" style=" margin-bottom: 20px;">
                    <textarea name="CompteRenduAbsent" style="height: 200px;resize: none;" class="input"  placeholder="Quelles en sont les raisons?" required ></textarea>
                </div>

            </div>


            <div id="OUI_NON_button" class="div_button">
                <label class="col-xs-12">Avez-vous pu assister au rendez-vous?</label>
                <input class="blue col-xs-3 col-xs-offset-3" style="right: 10px;text-align: center"
                       onclick="document.getElementById('Assister').style.display = 'block';document.getElementById('Assister_button').style.display = 'block';this.parentElement.style.display = 'none'"
                       type="button" value="OUI">
                <input class="blue col-xs-3" style="left: 10px;text-align: center"
                       onclick="document.getElementById('Absence').style.display = 'block';document.getElementById('Absence_button').style.display = 'block';this.parentElement.style.display = 'none'"
                       type="button"   value="NON">
            </div>
            <div id="Absence_button" class="div_button" style="display: none">
                <input onclick="fermeture()" class="blue" style="background:white;color:#666666;border:1px solid #ccc;float: left" type="button" value="Annuler">
                <input class="blue" type="button" onclick="EnvoyerCompteRendu('Absence')"  style="margin-left: 390px" value="Envoyer">
            </div>
            <div id="Assister_button" class="div_button" style="display: none">
                <input class="blue" onclick="fermeture()" style="background:white;color:#666666;border:1px solid #ccc;float: left;text-align: center ;width: 120px;height:50px" type="button" value="Annuler">
                <input class="blue" type="button" onclick="EnvoyerCompteRendu('Assister')" style="margin-left: 300px;text-align:center;width: 120px;height:50px"  value="Envoyer">
            </div>

        </form>

    </div>


</div>
<div id="ConsultationCompteRendu" class="popup" >
    <div onclick="hide(this)" class="close"></div>
    <div class="col-xs-offset-1 col-xs-7" style="background-color: white;padding: 0;border:20px solid white;display: block; margin-left: 20%; ">
        <div id="ComptesRenduContainer"></div>
    </div>
</div>


<div id="MiseEnRelationPopup" class="popup" >

    <div onclick="fermeture();hide(this)" class="close"></div>
    <div class="col-xs-offset-1 col-xs-7" style="background-color: white;padding: 0;border:20px solid white;display: block; margin-left: 20%; ">
        <span class="glyphicon glyphicon-remove" aria-hidden="true" style="float:right; height:40px; font-size:20px"onclick="this.parentElement.previousElementSibling.click();"> </span>

        <div class="row chat-window col-xs-5 col-md-3" id="chat_window_1" style="width:90%;margin-left:10px;background-color: #66afe9">
            <div style="height: 120px ">
                <img id="imgSociete" style="margin-top:10px;float:left;margin-left: 20px;height:70px;width:70px;margin:15px 40px;border-radius: 100%" src="{{ asset('image/entreprise.jpg') }}">
                <label id="lblSociete" style="margin-top:10px;float:left;margin-left: 20px"></label>

                <img id="imgApp" style="margin-top:10px;float:right;margin-right: 20px;height:70px;width:70px;margin:15px 40px;border-radius: 100%" src="">
                <label id="lblApp"style="margin-top:10px;float:right;" ></label>
            </div>
            <div class="col-xs-12 col-md-12">

                <div class="panel panel-default">

                    {% if AllMiseEnRelation is defined %}
                        {% set i=0 %}
                        {% for mise in AllMiseEnRelation %}
                            {% if mise.expediteur.hasrole('ROLE_APPRENANT') %}

                                <div id="Msg{{ i }}" class="row msg_container base_receive" style="margin-right: 1px;margin-left: 50px" name="App{{ mise.expediteur.getId() }}_Mission{{mise.mission.getId()}}">
                                    <div class="col-md-10 col-xs-10">
                                        <div class="messages msg_sent" style="background: #F5F6CE";>

                                            <p style="width: 70%">{{ mise.getMessage }}</p>

                                            <time style="margin-top: -20px;" ><label style="text-transform :uppercase;color:{{ mise.couleur }};font-size:15px">{{ mise.getAction }}</label><br>{{ mise.getDate|date('d-m-Y Ã  H:i') }}</time>

                                        </div>
                                    </div>
                                    <div class="col-md-10 col-xs-10">

                                    </div>
                                    <div class="col-md-2 col-xs-2 avatar">
                                        {% if mise.expediteur.getPhotos %}
                                            <img style="height:70px;width:70px;margin:0 40px;border-radius: 100%" src="data:image/jpg;base64,{{GetMyPhoto(mise.expediteur.getId())}}">
                                        {% elseif mise.expediteur.getCivilite == 'Mme' or mise.expediteur.getCivilite == 'Madame' or mise.expediteur.getCivilite == 'Mademoiselle' %}
                                            <img style="height:70px;width:70px;margin:0 40px;border-radius: 100%" src="{{ asset('image/femme.jpg') }}">
                                        {% else %}
                                            <img style="height:70px;width:70px;margin:0 40px;border-radius: 100%" src="{{ asset('image/homme.jpg') }}">
                                        {% endif %}


                                    </div>
                                </div>
                            {% else %}



                                <div id="Msg{{ i }}" class="row msg_container base_sent"  style="margin-right: 50px;margin-left: -45px"  name="App{{ mise.destinataire.getId() }}_Mission{{mise.mission.getId()}}">
                                    <div class="col-md-2 col-xs-2 avatar">
                                        <img style="height:70px;width:70px;margin:0 40px;border-radius: 100%" src="{{ asset('image/Entreprise.jpg') }}">

                                    </div>
                                    <div class="col-md-10 col-xs-10">
                                        <div class="messages msg_receive" style="background: #CEECF5;">
                                            <p style="width: 70%;margin-left: 30%">{{ mise.getMessage }}
                                                {#or mise.getAction=='Reporter le RDV' #}
                                                {% if mise.getAction=='Propose rdv' %}
                                                    <br/>
                                                    {{ GetDateRDV(mise.destinataire.getId(),mise.mission.getId()) }}



                                                {% endif %}
                                            </p>



                                            <time style="margin-top: -20px;" ><label style="text-transform :uppercase;color:{{ mise.couleur }};font-size:15px ">{{ mise.getAction }}</label><br>{{ mise.getDate|date('d-m-Y Ã  H:i') }}</time>
                                        </div>
                                        <br/>
                                        <br/>
                                    </div>

                                    {% if (mise.getAction=='Propose rdv' or mise.getAction=='Reporter le RDV') and  mise.getId==GetIdTopOfMessges(mise.destinataire,mise.mission)  and (GetIdTopOfMessges(mise.destinataire,mise.mission)>GetIdTopOfMessges(mise.expediteur,mise.mission))  %}
                                        {% set rdv=GetRDV(mise.destinataire.getId(),mise.mission.getId()) %}

                                        {% if not rdv.getStatut or  (rdv.getStatut=='-1' and mise.getAction=='Reporter le RDV')  %}

                                     <div  id="DivConfirmationRDV{{ rdv.id }}">

                                         <label>Action :</label>
                                         <select id="Action_rdv{{ rdv.id }}" onchange="EnableControle(this.selectedIndex,{{ rdv.id }});" title="Actions" >
                                             <option value="Accepter">Accepter RDV</option>
                                             <option value="Reporter">Reporter RDV</option>
                                             <option value="Annuler">Annuler RDV</option>
                                         </select>
                                         <br/>
                                         <br/>

                                         <div id="dates_rdv{{ rdv.id }}" >


                                         {% if rdv.date1 %}
                                             <label  > {{ rdv.getDate1|date('d-m-Y Ã  H:i') }}
                                                 {% if (app.user == rdv.apprenant and rdv.choixApprenant) or (app.user == rdv.tuteur and not rdv.choixApprenant) %}

                                                     <input type="radio" id="r1{{ rdv.id }}" name="RadioDate" value="1">
                                                 {% endif %}
                                             </label>
                                         {% endif %}
                                         <br/>
                                         {% if rdv.date2 %}
                                             <label  > {{ rdv.getDate2|date('d-m-Y Ã  H:i') }}
                                                 {% if (app.user == rdv.apprenant and rdv.choixApprenant) or (app.user == rdv.tuteur and not rdv.choixApprenant) %}
                                                     <input type="radio" id="r2{{ rdv.id }}" name="RadioDate" value="2">
                                                 {% endif %}
                                             </label>
                                         {% endif %}
                                         <br/>
                                         {% if rdv.date3 %}
                                             <label  > {{ rdv.getDate3|date('d-m-Y Ã  H:i') }}
                                                 {% if (app.user == rdv.apprenant and rdv.choixApprenant) or (app.user == rdv.tuteur and not rdv.choixApprenant) %}
                                                     <input type="radio"  id="r3{{ rdv.id }}" name="RadioDate" value="3">
                                                 {% endif %}
                                             </label>
                                         {% endif %}

                                             <br/>
                                             <br/>
                                         </div>
                                         <div id="Reporter_rdv{{ rdv.id }}" style="display:none;">

                                             <button type="button" onclick="AddDateTimeDiv(this,{{ rdv.id }})">+</button>
                                             <div class="col-xs-4 col-xs-offset-4">
                                                 <label class="col-xs-1">Le </label><input title="Date du rendez-vous" name="dateRDV[]" type="text" class="col-xs-4" required>
                                                 <label class="col-xs-1"> Ã  </label><input title="Heure du rendez-vous" name="timeRDV[]{{ rdv.id }}" class="col-xs-4" type="text" required>
                                                 <button type="button" class="col-xs-offset-1 col-xs-1" onclick="if(this.parentElement.parentElement.children.length > 2){this.parentNode.parentNode.removeChild(this.parentNode);}">-</button>
                                             </div>

                                         </div>


                                        <br/><br/>



                                            <textarea id="Message_rdv{{ rdv.id }}" style="margin-left: 100px;background-color:#F5F6CE;;width:80%;height: 100px;resize: none;" class="input" name="Message" placeholder="Saisissez votre message ici" required ></textarea>
                                         <br/>
                                         <br/>

                                            <input  style="border: 0;font: 18px Roboto;text-align: left;background-color:white ;height: 40px;" type="button" onclick="EnvoyerRDV({{ rdv.id }})"  style="margin-left: 100px" value="Envoyer">

                                     </div>
                                        {% endif %}





                                    {% endif %}

                                </div>
                            {% endif %}

                            {% set i = i + 1 %}
                        {% endfor %}
                    {% endif %}

                </div>
            </div>
        </div>



    </div>




</div>
<div style="border-top: 1px solid #B0B0B0;background-color:  rgb(238, 241, 246);margin: 0;height: 100%;padding-bottom: 40px;overflow: hidden;">

    <div class="col-xs-10 col-xs-offset-1" style="margin-top: 10px;">
        {# <select class="input col-xs-2" title="messages" style="height:40px;">
             <option value="les messages">Tous les rendez-vous</option>
         </select>#}
        <div class="col-xs-2" style="margin-left: 20px;height:40px;display: flex;">
            <span class="glyphicon glyphicon-search col-xs-2" id="basic-addon1" style="height: 30px;padding: 7px;float: left;border: none;border-bottom: 1px solid #CCCCCC;margin: auto 0;background-color: transparent;"></span>
            <input class="col-xs-10" type="text" onkeyup="search(this.value)" aria-describedby="basic-addon1" style="height: 31px;border: none;border-bottom: 1px solid #CCCCCC;margin: auto 0;background-color: transparent;" placeholder="Recherche ...">
        </div>
        <div id="paginationContainer" class="customepaginate" style="max-width: 240px;float: right;display: flex;">
            <button  class="blue" style="background:white;color:#257ef0;border:1px solid #ccc;height:40px;width: 40px;float: right;" type="button" ><span class="glyphicon glyphicon-play" aria-hidden="true"></span></button>
        </div>

    </div>

    <div id="ListeMissionPropose"  class="col-xs-10 col-xs-offset-1">
        {% if MiseEnRelation is defined %}
            {% for mise in MiseEnRelation %}

                <div id="{{ mise.id }}" class="Liste" style="border: 1px solid #ddd;margin: 0;height:100px;width: 100%;" >
                    {# <div name="Recherche" style="display: none;">{{ rdv.destinataire.nom }},{{ rdv.destinataire.prenom }},{{ rdv.destinataire.email }},{{ rdv.tuteur.nom }},{{ rdv.tuteur.prenom }},{{ rdv.tuteur.email }},{% if rdv.mission %}{{ rdv.mission.intitule }},{{ rdv.mission.codemission }},{{ rdv.mission.descriptif }},{{ rdv.mission.domaine }},{% if rdv.mission.etablissement %}{{ rdv.mission.etablissement.siret }},{{ rdv.mission.etablissement.adresse }},{{ rdv.mission.etablissement.secteur }},{{ rdv.mission.etablissement.tier.raisonsoc }}{% endif %}{% endif %}</div>#}

                    <div class="col-xs-2" style="width:20%;" >
                        <div style="border: 15px solid transparent">

                                <img style="height:70px;width:70px;margin:0 40px;border-radius: 100%" src="{{ asset('image/Entreprise.jpg') }}">

                        </div>
                    </div>

                    <div id="date{{ mise.id }}" class="col-xs-2" style="width:20%;-webkit-flex-wrap: wrap;flex-wrap: wrap;display: -webkit-box;display: -moz-box;display: -ms-flexbox;display: -webkit-flex;;display:flex;height: 100px;text-align: left; ">

                        <label style="font:18px Roboto;margin: auto;" > {{ mise.mission.getEtablissement.getTier.getRaisonsoc }}</label><br/>


                    </div>

                    <div id="date{{ mise.id }}" class="col-xs-2" style="width:20%;-webkit-flex-wrap: wrap;flex-wrap: wrap;display: -webkit-box;display: -moz-box;display: -ms-flexbox;display: -webkit-flex;;display:flex;height: 100px;text-align: left; ">

                        <label style="font:18px Roboto;margin: auto;" > {{ mise.mission.intitule }}<br/></label><br/>


                    </div>

                    <div id="date{{ mise.id }}" class="col-xs-2" style="width:20%;-webkit-flex-wrap: wrap;flex-wrap: wrap;display: -webkit-box;display: -moz-box;display: -ms-flexbox;display: -webkit-flex;;display:flex;height: 100px;text-align: left; ">

                        <label style="font:18px Roboto;margin: auto;" > {{ mise.getDate|date('d-m-Y Ã  H:i') }}</label>

                    </div>

                    <div class="col-xs-2" style="width:20%;">
                        <div style="border: 15px solid transparent">
                           <img style="height:70px;width:70px;float:left;" onclick="Afficher({{ mise.mission.getId }});show('MissionPopup');" src="{{ asset('image/loupe.jpg') }}">

                            {% if mise.destinataire.getPhotos %}

                                <img style="height:70px;width:70px;float:left;border-radius: 100%" onclick="AfficherChat('{{ mise.destinataire.getId()}}','{{ mise.mission.getId() }}','{{ mise.mission.getEtablissement.getTier.getRaisonsoc }}<br/>{{ mise.mission.intitule }}','{{ mise.destinataire.getNom }}<br/>{{ mise.destinataire.getPrenom }}','data:image/jpg;base64,{{ mise.destinataire.getPhotos }}');show('MiseEnRelationPopup');" src="{{ asset('image/MiseEnRelation.png') }}">
                            {% elseif mise.destinataire.getCivilite == 'Mme' or mise.destinataire.getCivilite == 'Madame' or mise.destinataire.getCivilite == 'Mademoiselle' %}


                                <img style="height:70px;width:70px;float:left;border-radius: 100%" onclick="AfficherChat('{{ mise.destinataire.getId()}}','{{ mise.mission.getId() }}','{{ mise.mission.getEtablissement.getTier.getRaisonsoc }}<br/>{{ mise.mission.intitule }}','{{ mise.destinataire.getNom }}<br/>{{ mise.destinataire.getPrenom }}','{{ asset('image/femme.jpg') }}');show('MiseEnRelationPopup');" src="{{ asset('image/MiseEnRelation.png') }}">
                            {% else %}

                                <img style="height:70px;width:70px;float:left;border-radius: 100%" onclick="AfficherChat('{{ mise.destinataire.getId()}}','{{ mise.mission.getId() }}','{{ mise.mission.getEtablissement.getTier.getRaisonsoc }}<br/>{{ mise.mission.intitule }}','{{ mise.destinataire.getNom }}<br/>{{ mise.destinataire.getPrenom }}','{{ asset('image/homme.jpg') }}');show('MiseEnRelationPopup');" src="{{ asset('image/MiseEnRelation.png') }}">
                            {% endif %}

                            {% if not mise.getStatut or not  GetStatutRDV(mise.destinataire.getId(),mise.mission.getId())  %}
                                <img style="height:70px;width:70px;float:left;" onclick="" src="{{ asset('image/avirtissement.png') }}">
                            {% endif %}

                        </div>
                    </div>




</div>

{% endfor %}
{% endif %}
</div>



    <div id="MissionPopup" class="popup" >

        <div onclick="fermeture();hide(this)" class="close"></div>
        <div class="col-xs-offset-1 col-xs-7" style="background-color: white;padding: 0;border:20px solid white;display: block; margin-left: 20%; ">
            <span class="glyphicon glyphicon-remove" aria-hidden="true" style="float:right; height:40px; font-size:20px"onclick="this.parentElement.previousElementSibling.click();"> </span>
            {% set i=0 %}
            {% for mise in MiseEnRelation %}

                {% set MyMission =affichageMission(mise.mission.getId(),'-1',app.user.id) %}


                <div class="divMissionPopup" id="Div_{{MyMission.mission.getId}}" style="padding: 0;display:none">


                    <div class="row" style="margin: 0;">

                        <img class="col-xs-1" src="data:image/jpg;base64,{{ MyMission.mission.getEtablissement.getTier.getLogo }}" style="height: 60px;width: 60px;border: 5px solid transparent;">
                        <div class="col-xs-4">
                            <div class="col-xs-12" style="height: 35px;text-align: left; ">
                                <label style="font:large Roboto;color:black;text-align: left;margin:15px 0 0 20px;" >{{ MyMission.mission.getIntitule }} - </label>
                                <label style="font:large Roboto;color:#2A76CC;text-align: left;margin-top:15px" > {{ MyMission.mission.getEtablissement.getTier.getRaisonsoc }}</label>
                            </div>
                            <div class="col-xs-12" style="height: 35px;text-align: left;font:medium Roboto;  margin:0 0 0 20px;">
                                {{MyMission.mission.getEtablissement.getAdresse }}, {{ MyMission.mission.getEtablissement.getCodePostal }} {{ MyMission.mission.getEtablissement.getVille }}
                            </div>
                        </div>


                        {# INFOS EN DUR COMMENTEES POUR LA PRESENTATION
                        <div class="col-xs-1">
                            <div class="col-xs-12" style="height: 30px;; padding-top: 10px;"><label style="font-size:large;color:#2A76CC;" > 18</label></div>
                            <div class="col-xs-12" style="height: 20px;width:100px;color: #666666;">mises en relation</div>
                        </div>
                        <div class=" col-xs-1">
                            <div class="col-xs-12" style="height: 30px; padding-top: 10px;"><label style="font-size: large;color:#2A76CC" > 5</label></div>
                            <div class="col-xs-12" style="height: 20px;color: #666666;">candidatures</div>
                        </div>
                        #}
                    </div>




                    <div class="row" style="margin: 0;">

                            <button id="ButtonInfoMission" class="col-xs-6 onglet slide"  type="button" data-show="info_mission{{ i }}"> FICHE MISSION</button>
                            <button id="ButtonMap" class="col-xs-6 onglet slide"  type="button" data-show="map{{ i }}" >CARTE DES APPRENANTS</button>
                            <div id="baronglet" class="col-xs-6" style="height: 5px;background-color: #257ef0; z-index: 60;"></div>

                    </div>



                    <div id="info_mission{{ i }}" style="border-top: 1px solid #B0B0B0;background-color:  rgb(238, 241, 246);margin: 0;overflow-y: auto;">
                        <form id="formMission" action="{{ path('missionModif') }}" onsubmit="ShowWaiter();" method="post" enctype="multipart/form-data">
                            <input type="hidden" value="{{ MyMission.mission.getId }}" id="id" name="_ID">
                            <div class="col-xs-9" style="width:65%;background: rgb(238, 241, 246); height: 100%;">

                                <div class="col-xs-12" style="margin-bottom: 50px">
                                    <div class="list-group affichage">

                                        <label class="list-group-item mission" >LA MISSION : <br/>
                                            <textarea id="Descriptif" name="_Descriptif" maxlength="255"  style="height:60px;color:black; font-weight: lighter" readonly >{{MyMission.mission.getDescriptif}}</textarea>
                                        </label>

                                        <label class="list-group-item mission" >LE PROFIL RECHERCHE :<br/>
                                            <textarea style="height:60px;color:black; font-weight: lighter" id="Profil" name="_Profil" required maxlength="255" readonly >{{MyMission.mission.getProfil}}</textarea>
                                        </label>


                                        <label class="list-group-item mission">Domaine : <br/>
                                            <input style="color:black; font-weight: lighter" value="{{MyMission.mission.getDomaine}}" type="text" id="Domaine" name="_Domaine" maxlength="45" readonly>
                                        </label>
                                        <label class="list-group-item mission">Contact Mission: </br>
                                            <label > Nom :</label> <label style="color:black;font-weight: lighter;margin-right: 30px;">{{ MyMission.mission.getNomcontact }}</label>
                                            <label > Prenom :</label> <label style="color:black;font-weight: lighter;margin-right: 30px;">{{ MyMission.mission.getPrenomcontact }}</label>
                                            <label > Fonction :</label>  <label style="color:black;font-weight: lighter;margin-right: 30px;" >{{ MyMission.mission.getFonctioncontact }}</label>
                                            <label > Tel :</label>  <label style="color:black;font-weight: lighter;margin-right: 30px;">{{ MyMission.mission.getTelcontact }}</label>
                                            <label > Mail : </label><label style="color:black;font-weight: lighter;margin-right: 30px;">{{ MyMission.mission.getEmailcontact }}</label>
                                        </label>

                                        <label class="list-group-item mission">Formation CiblÃ©es: </br>

                                            {% for Diffusion in MyMission.Diffusions %}
                                                <div class="row" style="width:100%">
                                                    <label style="color: black;font-weight: lighter;float: left;line-height:40px;margin-right: 40px;">{{ Diffusion.formation.nom }} - {{ Diffusion.formation.etablissement.tier.raisonsoc }} - {{ Diffusion.formation.etablissement.adresse }} </label>

                                                    {% if Diffusion.formation.nomDoc %}
                                                        <label class="cell" style="height: 40px;">Document : <a target="_blank" href="{{ asset('formation_pdf/'~ Diffusion.formation.getId ~'.pdf') }}" >
                                                                <img src="{{ asset('image/PDF.jpg') }}"  style="width:40px; height:40px " alt="fichier de formation" >
                                                            </a>
                                                        </label>
                                                    {% endif %}
                                                </div>
                                            {% endfor %}

                                        </label>

                                        <label class="list-group-item mission" >Commentaire :<br/>
                                            <textarea style="color:black;height: 100px; font-weight: lighter" id="Commentaire" name="_Commentaire"  maxlength="255" readonly >{{MyMission.mission.getCommentaire}}</textarea>
                                        </label>

                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-3"
                                 style="height: 100%;width: 35%">
                                <div class="list-group"
                                     style="margin:15px 0 0 5px;height: 100%; background-color: white;">
                                    <div  class="rightMenu" style="padding: 8px !important;" >
                                        <span class="glyphicon glyphicon-time" aria-hidden="true" style="float: left;"></span>
                                        <label>Date creation :</label><input  value="{{MyMission.mission.getDatecreation|date('d/m/Y')}}" title="DateCreation" disabled>
                                    </div>
                                    <div class="rightMenu" style="padding: 8px !important;" >
                                        <span class="glyphicon glyphicon-user" aria-hidden="true" style="float: left;" ></span>
                                        <label style="margin-right: 65px;">Nom :</label> <input value="{{ MyMission.mission.nomcontact }} {{ MyMission.mission.prenomcontact }}" title="prenomContact" disabled>
                                    </div>
                                    <div class="rightMenu" style="padding: 8px !important;">
                                        <span class="glyphicon glyphicon-envelope" aria-hidden="true" style="float: left;"></span>
                                        <label style="margin-right: 60px;">Email :</label><input value="{{MyMission.mission.getEmailcontact}}" type="email" name="_Emailcontact" title="Emailcontact" maxlength="45" readonly>
                                    </div>
                                    <div class="rightMenu" style="padding: 8px !important;">
                                        <span class="glyphicon glyphicon-list-alt" aria-hidden="true" style="float: left;"></span>
                                        <label style="margin-right: 5px">Type contrat :</label><input value="{{MyMission.mission.getTypecontrat}}" type="text" id="TypeContrat" name="_TypeContrat" title="TypeContrat" maxlength="45" readonly>
                                    </div>
                                    <div class="rightMenu" style="padding: 8px !important;">
                                        <span class="glyphicon glyphicon-list-alt" aria-hidden="true" style="float: left;"></span>
                                        <label style="margin-right: 35px;">Fonction :</label><input value="{{MyMission.mission.getFonctioncontact}}" type="text" id="Fonctioncontact" name="_Fonctioncontact" title="getFonctioncontact" maxlength="45" readonly>
                                    </div>
                                    <div  class="rightMenu " style="padding: 8px !important;">
                                        <span class="glyphicon glyphicon-calendar" aria-hidden="true" style="float: left;"></span>
                                        <label style="margin-right: 25px;" >Date debut :</label><input value="{{MyMission.mission.getDatedebut|date('d/m/Y')}}" type="text"  id="Datedebut" name="_Datedebut" title="datedebut" readonly>
                                    </div>
                                    <div  class="rightMenu " style="padding: 8px !important;">
                                        <span class="glyphicon glyphicon-calendar" aria-hidden="true" style="float: left;"></span>
                                        <label style="margin-right: 45px;">Date fin :</label><input value="{{MyMission.mission.getDatefin|date('d/m/Y')}}" type="text"  id="Datefin" name="_Datefin" title="dateFin" readonly>
                                    </div>
                                    <div class="rightMenu" style="padding: 8px !important;" >
                                        <span class="glyphicon glyphicon-eur" aria-hidden="true" style="float: left;"></span>
                                        <label style="margin-right: 40px;">Nb poste :</label><input value="{{MyMission.mission.getNbreposte}}" type="number" id="Nbreposte" name="_Nbreposte" title="Nbreposte" maxlength="5" readonly>
                                    </div>
                                    <div class="rightMenu" style="padding: 8px !important;" >
                                        <span class="glyphicon glyphicon-eur" aria-hidden="true" style="float: left;"></span>
                                        <label>Remuneration :</label><input value="{{MyMission.mission.getRemuneration}}" type="number" id="Remuneration" name="_Remuneration" title="Remuneration" maxlength="5" readonly>
                                    </div>
                                    <div class="rightMenu" style="padding: 8px !important;">
                                        <span class="glyphicon glyphicon-qrcode" aria-hidden="true" style="float:left;"></span>
                                        <label style="margin-right: 10px;">code mission :</label><input placeholder="Code mission"  value="{{MyMission.mission.getCodemission}}" name="_Codemission" title="Code mission" required maxlength="9" type="text" readonly>
                                    </div>

                                    {#  {% if is_granted('ROLE_RECRUTEUR') or is_granted('ROLE_ADMINSOC') %} #}
                                    {% set modif = false %}
                                    {% if is_granted('ROLE_SUPER_ADMIN') or (MyMission.mission.tier == app.user.tier and (is_granted('ROLE_ADMINSOC') or is_granted('ROLE_ADMINECOLE'))) %}
                                        {% set modif = true %}
                                    {% elseif app.user.etablissement and MyMission.mission.tier == app.user.etablissement.tier and is_granted('ROLE_RECRUTEUR') %}
                                        {% set modif = true %}
                                    {% endif %}


                                </div>

                            </div>
                        </form>


                    </div>




                    <div id="map{{ i }}" style="height: 100%;width: 100%;position: absolute;visibility: hidden;">

                    </div>





                        <div id="wrapper" class="infobox-wrapper">
                            <div id="Societe_Info{{ i }}" class="infobox">
                                <div class="inbox" >
                                    <div >
                                        <img src="data:image/jpg;base64,{{ MyMission.mission.etablissement.tier.getLogo }}" style="height:100%;width: 100%;border-radius: 50%;">
                                    </div>
                                </div>
                                <label class="col-xs-12" style="color:white;font: 10px Roboto;text-transform: uppercase; text-align: center;top:30px;">{{ MyMission.mission.intitule }} - {{ MyMission.mission.etablissement.tier.raisonsoc }}</label>
                                <label class="col-xs-12" style="color:white;font: 10px Roboto;text-transform: uppercase; text-align: center;top:30px;">4.7<img src="{{ asset('image/bookmark50.png') }}" style="height: 10px"></label>
                                <button type="button" class="col-xs-12" style="margin-top: 30px;">Voir sa fiche</button>
                                <button type="button" class="col-xs-12" >Mettre en relation</button>
                                <button class="col-xs-12">plus</button>
                            </div>
                        </div>


                </div>
                <div id="Localisation{{ i }}"  style="border-top: 1px solid #B0B0B0;margin: 0;height: 281px;width: 100%;display:none;">


                </div>

              {% set i=i+1 %}

            {% endfor %}

        </div>




    </div>
</div>


<script type="text/javascript" src="http://maps.google.com/maps/api/js"></script>

<script src="{{ asset('js/OverlappingMarkerSpiderfier.min.js') }}"></script>
<script src="{{ asset('js/infobox.js') }}"></script>



<script src="{{ asset('js/jquery-1.11.3.js') }}"></script>
<script src="{{ asset('js/jquery-ui.min.js') }}"></script>
<script src="{{ asset('js/bootstrap.min.js') }}"></script>
<script src="{{ asset('js/PopUp.js') }}"></script>
<script src="{{ asset('js/paginate.js') }}"></script>
<script language="JavaScript">
var rendezvousSelectionne;
function AddDateTimeDiv(button,idRdv){
    if(button.parentElement.children.length < 4) {
        var divContainer = document.createElement('div');
        divContainer.className = 'col-xs-4 col-xs-offset-4';
        //label DATE
        var LabelDate = document.createElement('label');
        LabelDate.className = 'col-xs-1';
        LabelDate.innerHTML = 'Le ';
        //INPUT DATE
        var inputDate = document.createElement('input');
        inputDate.setAttribute('name','dateRDV[]');
        inputDate.setAttribute('id',button.nextElementSibling.firstElementChild.id +'_'+button.parentElement.children.length);
        inputDate.setAttribute('type','text');
        inputDate.className = "col-xs-4";
        //label DATE
        var LabelTime = document.createElement('label');
        LabelTime.className = 'col-xs-1';
        LabelTime.innerHTML = ' Ã  ';
        //INPUT TIME
        var inputTime = document.createElement('input');
        inputTime.setAttribute('name','timeRDV[]'+idRdv);
        inputTime.setAttribute('id',button.nextElementSibling.children[1].id +'_'+button.parentElement.children.length);
        inputTime.setAttribute('type','text');
        inputTime.className = "col-xs-4";
        //delete button
        var deleteButton = document.createElement('button');
        deleteButton.setAttribute('onclick','if(this.parentElement.parentElement.children.length > 2){this.parentNode.parentNode.removeChild(this.parentNode);}');
        deleteButton.setAttribute('type','button');
        deleteButton.className = "col-xs-offset-1 col-xs-1";
        deleteButton.innerHTML = '-';

        //append
        divContainer.appendChild(LabelDate);
        divContainer.appendChild(inputDate);
        divContainer.appendChild(LabelTime);
        divContainer.appendChild(inputTime);
        divContainer.appendChild(deleteButton);

        button.parentNode.appendChild(divContainer);
    }
}
$(document).on( "focus", "input[name='dateRDV[]']:not(.hasDatepicker)", function() {
//toastr.info( "Initializing " + this.id );

$( this ).datepicker({
changeMonth: true,
changeYear: true,
showButtonPanel: true,
dateFormat: 'dd/mm/yy',
monthNames: ["01","02","03","04","05","06","07","08","09","10","11","12"],
monthNamesShort: ["01","02","03","04","05","06","07","08","09","10","11","12"],
onClose: function(dateText, inst) {
$(this).datepicker('setDate', new Date(inst.selectedYear, inst.selectedMonth, inst.selectedDay));
}
});
});

$(document).ready(function(){
window.parent.document.getElementById('iframe').style.left ='0';
window.parent.document.getElementById('iframe').style.top ='32px';
window.parent.document.getElementById('iframe').style.height ='calc(100% - 32px)';
window.parent.document.getElementById('iframe').style.position ='fixed';
window.parent.document.getElementById('iframe').style.visibility ='visible';
$("#paginationContainer").customPaginate({
itemsToPaginate : ".Liste",
activeClass : "active-class"
});

});

function Afficher(idMission){
    for(i=0 ; i < document.getElementsByClassName('divMissionPopup').length;i++)
    {
            document.getElementById(document.getElementsByClassName('divMissionPopup')[i].id).style.display='none';
    }
    document.getElementById('Div_'+idMission).style.display='block';
}

function EnableControle(index,idRDV){


    var idDate="dates_rdv".concat(idRDV);
    if (index=='0'){

        document.getElementById(idDate).style.display="block";
        document.getElementById('Reporter_rdv'+idRDV).style.display="none";
    } else if (index=='1')
    {
        document.getElementById('Reporter_rdv'+idRDV).style.display="block";
        document.getElementById(idDate).style.display="none";
    }else{
        document.getElementById('Reporter_rdv'+idRDV).style.display="none";
        document.getElementById(idDate).style.display="none";
    }

}

function EnvoyerRDV(IdRdv)
{

    var DateSelect;
    var Message;
    var Action;
    var idDivRDV='DivConfirmationRDV'+IdRdv;
    Message=document.getElementById('Message_rdv'+IdRdv).value;
    Action=document.getElementById('Action_rdv'+IdRdv).value;
    var radios = document.getElementsByName("RadioDate")

    for (var i=0, len=radios.length; i<len; i++) {
        if ( radios[i].checked ) {
            DateSelect = radios[i].value;
            break;
        }
    }
    if (Action=='Accepter' ){

        if (DateSelect==null){

            alert('Veuillez cocher une date de RDV');

        }else{
         // ici l'acceptation du RDV


                ShowWaiter();
                var route = '{{ path('DateRDV',{'id':'_ID','numero':'_NUMERO','textmessage':'_TEXTMESSAGE'}) }}';
                route = route.replace('_ID',IdRdv);
                route= route.replace('_NUMERO',DateSelect);
                route= route.replace('_TEXTMESSAGE',Message);


                $.ajax({
                    url: route,
                    type:'POST',
                    error: function(){
                        DeleteWaiter();
                        alert('une erreur s\'est produite, veuillez rÃ©essayer plus tard!');
                    },
                    success: function(data){
                       if(data===1){


                           document.getElementById(idDivRDV).style.display="none";

                        }
                        DeleteWaiter();
                    }
                });



        }

    }else if (Action=='Reporter'){
     // ici reportation RDV

        var inputTimes = document.getElementsByName('timeRDV[]'+IdRdv);
        var DateTimeRdv
        for(var k = 0; k < inputTimes.length; k++){
            var isValid = /^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/.test(inputTimes[k].value);




            if (!isValid) {
                alert('verifiez que les heure respect le format HH:MM');
                return;
            }else{
                if(DateTimeRdv == null){
                    DateTimeRdv=inputTimes[k].previousElementSibling.previousElementSibling.value+' '+inputTimes[k].value+';'
                }else{
                    DateTimeRdv=DateTimeRdv+inputTimes[k].previousElementSibling.previousElementSibling.value+' '+inputTimes[k].value+';'
                }
            }
        }
        ShowWaiter();
        var route = '{{ path('AjournementRDV',{'id':'_ID','DateTimeRdv':'_DateTimeRdv','MessageTexte':'_MessageTexte'}) }}';
        //DateTimeRdv=DateTimeRdv.replace("/","Â£Â£");
        DateTimeRdv=replaceAll(DateTimeRdv, '/', 'Â£Â£');
        Message=replaceAll(Message, '/', 'Â£Â£');
        route = route.replace('_ID',IdRdv);
        route = route.replace('_DateTimeRdv',DateTimeRdv);
        route = route.replace('_MessageTexte',Message);


        $.ajax({
            url: route,
            type:'POST',
            data: $('#PopUpAjournement').serialize(),
            error: function(){
                DeleteWaiter();
                alert('une erreur s\'est produite, veuillez rÃ©essayer plus tard!');
            },
            success: function(data){
                //document.getElementById(idDivRDV).style.display="none";
                //alert(idDivRDV);
                document.getElementById(idDivRDV).style.display="none";
                DeleteWaiter();
            }



        });



    }else{
     // ici annulation RDV

        if(confirm('Confirmez-vous l\'annulation du rendez-vous?')){
            ShowWaiter();
            var route = '{{ path('AnnulerRDV',{'id':'_ID','MessageTexte':'_MessageTexte'}) }}';
            Message=replaceAll(Message, '/', 'Â£Â£');
            route = route.replace('_ID',IdRdv);
            route = route.replace('_MessageTexte',Message);

            $.ajax({
                url: route,
                type:'POST',
                error: function(){
                    DeleteWaiter();
                    alert('une erreur s\'est produite, veuillez rÃ©essayer plus tard!');
                },
                success: function(data){
                    if(data===1){

                        document.getElementById(idDivRDV).style.display="none";
                    }
                    DeleteWaiter();
                }
            });
        }

    }





   //alert(Message);
    //alert(IdRdv);
    //alert(DateSelect);




}
function replaceAll(machaine, chaineARemaplacer, chaineDeRemplacement) {
    return machaine.replace(new RegExp(chaineARemaplacer, 'g'),chaineDeRemplacement);
}
function AfficherChat(idApp,idMission,Societe,Appre,ImgApp){

//alert(idApp+' / '+idMission);

document.getElementById('lblSociete').innerHTML=Societe;
document.getElementById('lblApp').innerHTML=Appre;
document.getElementById('imgApp').src=ImgApp;

var NameDivMsg = 'App'+idApp+'_Mission'+idMission;

var i=0;
var IdDivMsg=''
var ClassDivSent='row msg_container base_sent';
var ClassDivReceive='row msg_container base_receive';
//class="row msg_container base_receive
//class="row msg_container base_sent
for(i=0 ; i < document.getElementsByName(NameDivMsg).length;i++)
{

IdDivMsg=IdDivMsg+"|;|"+document.getElementsByName(NameDivMsg)[i].id+"|;|"

};


for(i=0 ; i < document.getElementsByClassName(ClassDivSent).length;i++)
{
if ( !(IdDivMsg.includes('|;|'+document.getElementsByClassName(ClassDivSent)[i].id+'|;|'))){

document.getElementById(document.getElementsByClassName(ClassDivSent)[i].id).style.display='none';
}else{
document.getElementById(document.getElementsByClassName(ClassDivSent)[i].id).style.display='block';

}

};

for(i=0 ; i < document.getElementsByClassName(ClassDivReceive).length;i++)
{
if ( !(IdDivMsg.includes('|;|'+document.getElementsByClassName(ClassDivReceive)[i].id+'|;|'))){

document.getElementById(document.getElementsByClassName(ClassDivReceive)[i].id).style.display='none';
}else{
document.getElementById(document.getElementsByClassName(ClassDivReceive)[i].id).style.display='block';

}

};
// mon javascript ici

}




function fermeture(){
var form = document.getElementById('PopUpCompteRendu');
for(var i = 0; i< form.childElementCount; i++){
form.children[i].style.display = 'none';
}
document.getElementById('OUI_NON_button').style.display = 'block';
}
function EnvoyerCompteRendu(part){
ShowWaiter();
var route = '{{ path('CompteRenduSaisie',{'id':'_ID'}) }}';
route = route.replace('_ID',rendezvousSelectionne);
$.ajax({
url: route,
type:'get',
data: $('#'+part+' textarea').serialize(),
error: function(){
DeleteWaiter();
alert('une erreur s\'est produite, veuillez rÃ©essayer plus tard!');
},
success: function(data){
if(data===1){
alert('Compte rendu envoyÃ©');
document.getElementById('CompteRendu').style.display = 'none';
fermeture();
}
DeleteWaiter();
}
});
}

function OrdreDeRemplirCR(id,rdv){
ShowWaiter();
var route = '{{ path('OrdreCompleterCR',{'idUser':'_IDUSER','idRDV':'_IDRDV'}) }}';
route = route.replace('_IDUSER',id);
route = route.replace('_IDRDV',rdv);
$.ajax({
type:'post',
url: route,
error: function(){
DeleteWaiter();
alert('une erreur s\'est produite, veuillez rÃ©essayer plus tard!');
},
success:function(data){
if(data==1){
alert('le message a Ã©tÃ© envoyÃ© correctement!')
}
else{
console.log(data);
}
DeleteWaiter();
},
error:function(){
alert('Une erreur s\'est produite sur le serveur');
DeleteWaiter();
}
})
}
function ConsulterCR(id){
ShowWaiter();
var route = '{{ path('ConsulterCR',{'idRDV':'_IDRDV'}) }}';
route = route.replace('_IDRDV',id);
$.ajax({
type: 'post',
url: route,
error: function(){
DeleteWaiter();
alert('une erreur s\'est produite, veuillez rÃ©essayer plus tard!');
},
success:function(data){
var container = document.getElementById('ComptesRenduContainer');
container.innerHTML = '';

for(var i = 0; i < data.length; i++){
var label = document.createElement('label');
label.style.color = '#2A76CC';
label.style.textTransform = 'uppercase';
label.style.float = 'left';
label.innerHTML = data[i][0] + ' - ' + data[i][2];

var textarea = document.createElement('textarea');
textarea.style.backgroundColor = '#e4b9b9';
textarea.innerHTML = data[i][1];

var divCompteRendu = document.createElement('div');
divCompteRendu.style.marginBottom = "20px";
divCompteRendu.appendChild(label);
divCompteRendu.appendChild(textarea);

container.appendChild(divCompteRendu);
}
show('ConsultationCompteRendu');
DeleteWaiter();
},
error:function(){
alert('Une erreur s\'est produite sur le serveur');
}
})
}
function search(mot){
var mots = mot.toUpperCase().trim().split(/ +/g);
var Recherches = document.getElementsByName('Recherche');
for(var i = 0; i < Recherches.length; i++)
{
var score = 0;
Recherches[i].parentNode.classList.remove('hidden');
var recherchermot = Recherches[i].innerHTML.toUpperCase().trim().split(/,+/g);
for(var k = 0; k< recherchermot.length; k++)
{
for(var j = 0; j< mots.length;j++)
{
if (stringWith(recherchermot[k], mots[j])) {
score++;
}
}
}
if(score === 0 ){
Recherches[i].parentNode.classList.add('hidden');
}
}
$(".Liste").show();
$("#paginationContainer").html('<button  class="blue" style="background:white;color:#257ef0;border:1px solid #ccc;height:40px;width: 40px;float: right;" type="button" ><span class="glyphicon glyphicon-play" aria-hidden="true"></span></button>').customPaginate({
itemsToPaginate : ".Liste:not(.hidden)",
activeClass : "active-class"
});

    var locations =[];
    var loc, map, map_localisation, marker, infobox;
    var idMRDestinataire;

    $(".slide").click(function(){
        document.getElementById('info_mission').style.visibility= 'hidden';
        {% if is_granted('ROLE_TUTEUR') or is_granted('ROLE_RECRUTEUR') %}
        document.getElementById('apprenants_mission').style.visibility= 'hidden';
        {% endif %}
        document.getElementById('map').style.visibility= 'hidden';
        document.getElementById($(this).attr("data-show")).style.visibility= 'visible';

        for(var i = 0; i < infoWindows.length ; i++){
            infoWindows[i].close();
        }
        var target = $(this).offset();

        $("#baronglet").animate({left: "+="+(target.left - $("#baronglet").offset().left)},500)
        sessionStorage.setItem('OngletMission',$(this).attr('id'));

    });

    function initialize() {
        /*map = new google.maps.Map(document.getElementById("map"), {
         zoom: 8,
         mapTypeId: google.maps.MapTypeId.ROADMAP
         });*/


        {% set i=0 %}
        {% for mise in MiseEnRelation %}

        {% set MyMission =affichageMission(mise.mission.getId(),'-1',app.user.id) %}


        {% if MyMission.mission.getEtablissement.getGeocode %}
        var geoloc = '{{ MyMission.mission.getEtablissement.getGeocode }}';
        geoloc = geoloc.substring(1,geoloc.length - 1).split(',');
        var lat = parseFloat(geoloc[0]);
        var long = parseFloat(geoloc[1]);

        loc = new google.maps.LatLng(lat,long);
        map = new google.maps.Map(document.getElementById("map{{ i }}"), {
            zoom: 10,
            center: loc,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        marker = new google.maps.Marker({
            map: map,
            position: loc,
            visible: true,
            icon: '{{ asset('image/societe.png') }}'
        });
        map_localisation = new google.maps.Map(document.getElementById("Localisation{{ i }}"), {
            zoom: 15,
            center: loc,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        marker = new google.maps.Marker({
            map: map_localisation,
            position: loc,
            visible: true,
            icon: '{{ asset('image/societe.png') }}'
        });

        putAppMarker();
        {% else %}
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({'address': '{{ MyMission.mission.getEtablissement.getAdresse}} {{  MyMission.mission.getEtablissement.getVille}} {{  MyMission.mission.getEtablissement.getCodePostal}}'}, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                loc = results[0].geometry.location;
                map = new google.maps.Map(document.getElementById("map{{ i }}"), {
                    zoom: 10,
                    center: loc,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                });
                marker = new google.maps.Marker({
                    map: map,
                    position: loc,
                    visible: true,
                    icon: '{{ asset('image/societe.png') }}'
                });
                map_localisation = new google.maps.Map(document.getElementById("Localisation{{ i }}"), {
                    zoom: 15,
                    center: loc,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                });
                marker = new google.maps.Marker({
                    map: map_localisation,
                    position: loc,
                    visible: true,
                    icon: '{{ asset('image/societe.png') }}'
                });
                {% if not is_granted('ROLE_TUTEUR') and not is_granted('ROLE_RECRUTEUR') %}
                infobox = new InfoBox({
                    content: document.getElementById("Societe_Info{{ i }}")
                    ,disableAutoPan: false
                    ,maxWidth: 0
                    ,pixelOffset: new google.maps.Size(-76, -212)
                    ,zIndex: null
                    ,closeBoxMargin: "4px 4px 4px 4px"
                    ,closeBoxURL: "{{ asset('image/close_infobox.png') }}"
                    ,infoBoxClearance: new google.maps.Size(1, 1)
                    ,isHidden: false
                    ,pane: "floatPane"
                    ,enableEventPropagation: false
                });
                infoWindows.push(infobox);

                google.maps.event.addListener(marker, "click", function() {
                    infobox.open(map, this);
                    map.panTo(loc);
                });
                {% endif %}
                putAppMarker();
            }
        });
        {% endif %}
        {% set i=i+1 %}
        {% endfor %}
    }
   google.maps.event.addDomListener(window, 'load', initialize);

}
</script>
</body>
</html>